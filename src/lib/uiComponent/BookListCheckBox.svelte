<script>
  import { CurrentUser } from "../backendService/UserService.js";
  import {
    addBooksToBookList,
    updateBooksInBookList,
  } from "../backendService/BookListService.js";
  import { getNotificationsContext } from "svelte-notifications";
  import { getNotify } from "../utility.js";

  const { success, info } = getNotify(
    getNotificationsContext().addNotification
  );

  export let thisBook = -1;
  export let list = {};
  let bookInBookList = list.books.indexOf(thisBook) !== -1;

  async function handleChange() {
    if (bookInBookList) {
      await addBooksToBookList($CurrentUser, list.id, [thisBook]);
      success(`已加入书单"${list.id}"`);
    } else {
      await updateBooksInBookList(
        $CurrentUser,
        list.id,
        list.books.filter((id) => id !== thisBook)
      );
      info(`已从书单"${list.id}"中移除`);
    }
  }
</script>

<label class="label cursor-pointer justify-start">
  <input
    bind:checked={bookInBookList}
    class="checkbox checkbox-secondary checkbox-md"
    on:change={handleChange}
    type="checkbox"
  />
  <span class="label-text ml-2 truncate">{list.id}</span>
</label>
